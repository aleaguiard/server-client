package servidor;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintStream;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.net.Socket;

public class SocketServidor {
	
	public static final int PUERTO = 2017;
	
	public static void main(String[] args) throws InterruptedException {
		System.out.println("      APLICACIÓN DE SERVIDOR      ");
		System.out.println("----------------------------------");
		
		
		InputStreamReader entrada = null;
	
		PrintStream salida = null;
		
		Socket socketAlCliente = null;
		
		InetSocketAddress direccion = new InetSocketAddress(PUERTO);
		
		try (ServerSocket serverSocket = new ServerSocket()){			
			
			serverSocket.bind(direccion);
			
			while(true){		
				
				System.out.println("SERVIDOR: Esperando peticion por el puerto " + PUERTO);
				
				socketAlCliente = serverSocket.accept();
				System.out.println("SERVIDOR: peticion recibida");
				
				entrada = new InputStreamReader(socketAlCliente.getInputStream());
				BufferedReader bf = new BufferedReader(entrada);
								
				//El servidor se quedaría aquí parado hasta que el cliente nos mande
				//informacion, es decir, cuando haga un salida.println(INFORMACION);				
				String stringRecibido = bf.readLine();//3-4
				
				//Hay que tener en cuenta que toda comunicacion entre cliente y servidor
				//esta en formato de cadena de texto
				System.out.println("SERVIDOR: Me ha llegado del cliente: " + stringRecibido);
				//Como sabemos que el cliente nos envia un 3-7, hacemos un split por "-"
				//para obtener la información.
				String[] operadores = stringRecibido.split("-");
				int iNumero1 = Integer.parseInt(operadores[0]);//3
				int iNumero2 = Integer.parseInt(operadores[1]);//4
				
				//Hay que tener en cuenta que es posible que los servidores tarden en responder
				//Thread.sleep(15000);
				
				//Es en este momento cuando calculamos la suma
				int resultado = iNumero1 + iNumero2;//7 
				System.out.println("SERVIDOR: El calculo de los numeros es: " + resultado);
								
				//Mandamos el resultado al cliente
				salida = new PrintStream(socketAlCliente.getOutputStream());
				salida.println(resultado);	
				
				//Si hemos llegado hasta aqui, cerramos las conexiones
				socketAlCliente.close();
			}
		} catch (IOException e) {
			System.err.println("SERVIDOR: Error de entrada/salida");
			e.printStackTrace();
		} catch (Exception e) {
			System.err.println("SERVIDOR: Error -> " + e);
			e.printStackTrace();
		}
	}
}